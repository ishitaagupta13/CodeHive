<!-- HTML Structure for Skills Input and Hackathon Recommendations -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hackathon Discovery Engine</title>
    <link rel="stylesheet" href="hackathon_discovery_styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Hackathon Discovery Engine</h1>
            <p>Find the perfect hackathon for your skills</p>
        </header>

        <section class="skills-section">
            <h2>Enter Your Skills</h2>
            <div class="skills-input">
                <input type="text" id="skill-input" placeholder="Enter a skill (e.g. JavaScript, ML, UI Design)">
                <button id="add-skill-btn">Add Skill</button>
            </div>
            <div class="skills-tags" id="skills-tags-container">
                <!-- Skills tags will be added here -->
            </div>
            <button id="find-hackathons-btn" class="primary-btn">Find Hackathons</button>
        </section>

        <section class="recommendations-section" id="recommendations-container">
            <h2>Recommended Hackathons</h2>
            <div class="hackathon-cards" id="hackathon-results">
                <!-- Hackathon cards will be displayed here -->
            </div>
        </section>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    
   
    <script>
        // Firebase configuration - replace with your Firebase project details
        const firebaseConfig = {
            apiKey: "AIzaSyAOmgh-bwztV2Ikuca2KqCjeZFQmVEOPjs",
            authDomain: "codehive-bcd90.firebaseapp.com",
            projectId: "codehive-bcd90",
            storageBucket: "codehive-bcd90.appspot.com",
            messagingSenderId: "300677091996",
            appId: "1:300677091996:web:c47af18d9e43f3355fd359"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // DOM elements
        const skillInput = document.getElementById('skill-input');
        const addSkillBtn = document.getElementById('add-skill-btn');
        const skillsTagsContainer = document.getElementById('skills-tags-container');
        const findHackathonsBtn = document.getElementById('find-hackathons-btn');
        const hackathonResults = document.getElementById('hackathon-results');
        
        let userSkills = [];
        
        // Add skill to list
        addSkillBtn.addEventListener('click', addSkill);
        skillInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addSkill();
            }
        });
        
        function addSkill() {
            const skill = skillInput.value.trim().toLowerCase();
            if (skill && !userSkills.includes(skill)) {
                userSkills.push(skill);
                skillInput.value = ''; // Clear input after adding
                renderSkillTags();
            }
        }
        
        // Remove skill from list
        function removeSkill(skill) {
            userSkills = userSkills.filter(s => s !== skill);
            renderSkillTags();
        }
        
        // Render skill tags properly
        function renderSkillTags() {
            skillsTagsContainer.innerHTML = ''; // Clear existing tags before re-rendering
            userSkills.forEach(skill => {
                const skillTag = document.createElement('div');
                skillTag.className = 'skill-tag';
                skillTag.innerHTML = `
                    ${skill}
                    <span class="remove-skill" data-skill="${skill}">&times;</span>
                `;
                skillsTagsContainer.appendChild(skillTag);
            });
        
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-skill').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    removeSkill(e.target.getAttribute('data-skill'));
                });
            });
        }
        
        // Find hackathons based on skills
        findHackathonsBtn.addEventListener('click', async () => {
            if (userSkills.length === 0) {
                alert('Please add at least one skill');
                return;
            }
        
            hackathonResults.innerHTML = '<p>Loading hackathons...</p>';
        
            try {
                const snapshot = await db.collection('hackathons').get();
                const hackathons = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
        
                // ðŸ”¥ Debugging: Check if Firestore is returning data
                console.log("ðŸ“‚ Hackathon data from Firestore:", hackathons);  
        
                displayHackathonRecommendations(hackathons);
            } catch (error) {
                console.error("ðŸš¨ Error fetching hackathons:", error);
                hackathonResults.innerHTML = '<p>Failed to load hackathons. Please try again later.</p>';
            }
        });
        //apply for hackathon
        async function applyForHackathon(hackathonId, hackathonTitle) {
            const user = firebase.auth().currentUser;
            if (!user) {
                alert("You need to log in first!");
                return;
            }
        
            const applicationRef = db.collection('applications').doc(user.uid + "_" + hackathonId);
            
            await applicationRef.set({
                userId: user.uid,
                userEmail: user.email,
                userName: user.displayName || "Anonymous",
                hackathonId: hackathonId,
                hackathonTitle: hackathonTitle,
                status: "pending", // Initially set to "pending"
                appliedAt: firebase.firestore.Timestamp.now()
            });
        
            alert("Application submitted! The organizer will review it.");
        }
        
        
        // Display hackathons
        function displayHackathonRecommendations(hackathons) {
            hackathonResults.innerHTML = '';
        
            hackathons.forEach(hackathon => {
                const hackathonSkills = hackathon.skills.map(skill => skill.toLowerCase());
        
                if (hackathonSkills.some(skill => userSkills.includes(skill))) {
                    const hackathonCard = document.createElement('div');
                    hackathonCard.className = 'hackathon-card';
                    hackathonCard.innerHTML = `
                        <h3>${hackathon.title}</h3>
                        <p>${hackathon.description}</p>
                        <p><strong>Date:</strong> ${hackathon.date}</p>
                        <p><strong>Location:</strong> ${hackathon.location}</p>
                        <button class="apply-btn" onclick="applyForHackathon('${hackathon.id}', '${hackathon.title}')">Apply Now</button>
                    `;
                    hackathonResults.appendChild(hackathonCard);
                }
            });
        
            if (hackathonResults.innerHTML === '') {
                hackathonResults.innerHTML = '<p>No matching hackathons found.</p>';
            }
        }
        
        </script>
        
        
</body>
</html>