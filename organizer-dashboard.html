<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizer Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <script src="organizer.js" defer></script>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <h1>CompetitionHub</h1>
        </div>
        <nav>
            <ul>
                <li class="active"><a href="#"><i class="icon-dashboard"></i> Dashboard</a></li>
                <li><a href="#"><i class="icon-participants"></i> Add A Hackathon </a></li>
                <li><a href="#"><i class="icon-participants"></i> Participants</a></li>
                <li><a href="#"><i class="icon-judges"></i> Judges</a></li>
                <li><a href="#"><i class="icon-schedule"></i> Schedule</a></li>
                <li><a href="#"><i class="icon-announcements"></i> Announcements</a></li>
                <li><a href="#"><i class="icon-settings"></i> Settings</a></li>
            </ul>
        </nav>
        <div class="profile">
            <div class="avatar"></div>
            <span ><a href="#" >Organizer Profile</a></span>
    
            <a href="#" class="logout">Log Out</a>
        </div>
    </div>

    <main>
        <header>
            <div class="search-bar">
                <input type="text" placeholder="Search participants, judges...">
                <button type="submit"><i class="icon-search"></i></button>
            </div>
            <div class="notifications">
                <i class="icon-bell"></i>
                <span class="badge">5</span>
            </div>
        </header>

        <div class="content">
            <h2>Welcome, Organizer!</h2>
            <div class="status-banner">
                <p>Competition status: <span class="status-active">Active</span></p>
                <p>Current phase: <span class="phase">Submission Phase</span></p>
            </div>

            <div class="dashboard-cards">
                <div class="card">
                    <h3>Registration Requests</h3>
                    <div class="card-content">
                        <div class="stat-circle warning">
                            <span>12</span>
                            <p>Pending</p>
                        </div>
                        <button class="btn primary" id="review-registrations">Review Requests</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Participant Statistics</h3>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-number">128</span>
                                <span class="stat-label">Total</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">96</span>
                                <span class="stat-label">Active</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">78</span>
                                <span class="stat-label">Submitted</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">32</span>
                                <span class="stat-label">Inactive</span>
                            </div>
                        </div>
                        <a href="#" class="view-all">View Full Report</a>
                    </div>
                </div>

                <div class="card">
                    <h3>Competition Timeline</h3>
                    <div class="card-content">
                        <div class="timeline">
                            <div class="timeline-item completed">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <h4>Registration Phase</h4>
                                    <p>Feb 1 - Feb 28, 2025</p>
                                </div>
                            </div>
                            <div class="timeline-item current">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <h4>Submission Phase</h4>
                                    <p>Mar 1 - Mar 20, 2025</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <h4>Judging Phase</h4>
                                    <p>Mar 21 - Apr 5, 2025</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <h4>Awards Ceremony</h4>
                                    <p>April 15, 2025</p>
                                </div>
                            </div>
                        </div>
                        <button class="btn secondary" id="edit-timeline">Edit Timeline</button>
                    </div>
                </div>
            </div>

            <div class="registration-approval" id="registration-panel">
                <h3>Pending Registration Requests</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Date</th>
                            <th>Profile</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Alex Johnson</td>
                            <td>alex.j@example.com</td>
                            <td>Mar 5, 2025</td>
                            <td><a href="#" class="btn-view">View</a></td>
                            <td>
                                <button class="btn-approve">Approve</button>
                                <button class="btn-reject">Reject</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Maya Rodriguez</td>
                            <td>maya.r@example.com</td>
                            <td>Mar 5, 2025</td>
                            <td><a href="#" class="btn-view">View</a></td>
                            <td>
                                <button class="btn-approve">Approve</button>
                                <button class="btn-reject">Reject</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Sam Williams</td>
                            <td>sam.w@example.com</td>
                            <td>Mar 4, 2025</td>
                            <td><a href="#" class="btn-view">View</a></td>
                            <td>
                                <button class="btn-approve">Approve</button>
                                <button class="btn-reject">Reject</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <a href="#" class="page-link active">1</a>
                    <a href="#" class="page-link">2</a>
                    <a href="#" class="page-link">3</a>
                    <a href="#" class="page-link">4</a>
                    <a href="#" class="page-link">Next</a>
                </div>
            </div>

            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                    <button class="btn primary" id="send-announcement">Send Announcement</button>
                    <button class="btn secondary" id="export-data">Export Data</button>
                    <button class="btn secondary" id="generate-report">Generate Report</button>
                    <button class="btn secondary" id="configure-settings">Configure Settings</button>
                </div>
            </div>
        </div>
    </main>

    <div class="modal" id="announcement-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>Send Announcement</h3>
            <form id="announcement-form">
                <div class="form-group">
                    <label for="announcement-title">Title</label>
                    <input type="text" id="announcement-title" required>
                </div>
                <div class="form-group">
                    <label for="announcement-message">Message</label>
                    <textarea id="announcement-message" rows="5" required></textarea>
                </div>
                <div class="form-group">
                    <label for="announcement-recipients">Send to</label>
                    <select id="announcement-recipients">
                        <option value="all">All Users</option>
                        <option value="participants">Participants Only</option>
                        <option value="judges">Judges Only</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn secondary" id="cancel-announcement">Cancel</button>
                    <button type="submit" class="btn primary">Send</button>
                </div>
            </form>
        </div>
    </div>
    <script>
    // This script can be added to each dashboard page to make the links functional
// It should be included after the existing script tags in each dashboard file
async function loadPendingApplications() {
    try {
        const applicationsRef = db.collection("applications").where("status", "==", "pending");
        const snapshot = await applicationsRef.get();
        
        // Get the table body where we'll insert the application data
        const tableBody = document.querySelector('#registration-panel tbody');
        if (!tableBody) {
            console.error("Registration table not found");
            return;
        }
        
        // Clear existing rows
        tableBody.innerHTML = '';
        
        // Update pending count in the stat circle
        const pendingCountElement = document.querySelector('.stat-circle.warning span');
        if (pendingCountElement) {
            pendingCountElement.textContent = snapshot.size;
        }
        
        // If no pending applications
        if (snapshot.empty) {
            tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No pending applications</td></tr>';
            return;
        }
        
        // Add each application to the table
        snapshot.forEach(doc => {
            const data = doc.data();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.userName || 'Unknown'}</td>
                <td>${data.userEmail || 'No email'}</td>
                <td>${new Date(data.appliedAt.toDate()).toLocaleDateString()}</td>
                <td><a href="#" class="btn-view" data-id="${doc.id}">View</a></td>
                <td>
                    <button class="btn-approve" data-id="${doc.id}" data-email="${data.userEmail}">Approve</button>
                    <button class="btn-reject" data-id="${doc.id}">Reject</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        // Add event listeners to the approve/reject buttons
        addApplicationButtonListeners();
        
    } catch (error) {
        console.error("Error loading applications:", error);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Initialize other dashboard functions
    initializeNavigationLinks();
    initializeDashboardActions();
    
    // Load pending applications if we're on the organizer dashboard
    if (window.location.pathname.includes('organizer-dashboard')) {
        loadPendingApplications();
    }
});

// Set up navigation between dashboards and within each dashboard
function initializeNavigationLinks() {
    // Map navigation items to their respective pages
    const navMap = {
        // Common navigation items
        "Dashboard": "index.html",
        "Schedule": "schedule.html",
        "Settings": "settings.html",
        
        // Judge-specific navigation
        "Submissions": "submissions.html",
        "Evaluation": "evaluation.html",
        "Criteria": "criteria.html",
        
        // Organizer-specific navigation
        "Participants": "participants.html",
        "Judges": "judges.html",
        "Announcements": "announcements.html",
        
        // Participant-specific navigation
        "My Submissions": "my-submissions.html",
        "Feedback": "feedback.html",
        "Rules": "rules.html"
    };
    
    // Get all navigation links
    const navLinks = document.querySelectorAll('nav ul li a');
    
    // Update href attributes based on link text
    navLinks.forEach(link => {
        const linkText = link.textContent.trim();
        if (navMap[linkText]) {
            link.href = navMap[linkText];
        }
    });
    
    // Make dashboard selection links work
    const dashboardLinks = {
        "Organizer Dashboard": "organizer-dashboard.html",
        "Judge Dashboard": "judge-dashboard.html",
        "Participant Dashboard": "participant-dashboard.html"
    };
    
    // Add dashboard switcher if not present
    if (!document.querySelector('.dashboard-switcher')) {
        const userInfo = document.querySelector('.user-info');
        if (userInfo) {
            const dashboardSwitcher = document.createElement('div');
            dashboardSwitcher.className = 'dashboard-switcher';
            dashboardSwitcher.innerHTML = `
                <select id="dashboard-select">
                    <option value="judge-dashboard.html">Judge Dashboard</option>
                    <option value="organizer-dashboard.html">Organizer Dashboard</option>
                    <option value="participant-dashboard.html">Participant Dashboard</option>
                </select>
            `;
            
            userInfo.insertBefore(dashboardSwitcher, userInfo.querySelector('.logout'));
            
            // Set current selection based on page
            const currentPage = window.location.pathname.split('/').pop();
            const selectElement = dashboardSwitcher.querySelector('select');
            if (selectElement) {
                selectElement.value = currentPage;
                
                // Add change event listener
                selectElement.addEventListener('change', function() {
                    window.location.href = this.value;
                });
            }
        }
    }
    
    // Make logout links functional
    const logoutLinks = document.querySelectorAll('.logout');
    logoutLinks.forEach(link => {
        link.href = "login.html";
    });
}
function addApplicationButtonListeners() {
    // Approve button listeners
    document.querySelectorAll('.btn-approve').forEach(button => {
        button.addEventListener('click', async function() {
            const applicationId = this.getAttribute('data-id');
            const userEmail = this.getAttribute('data-email');
            await approveApplication(applicationId, userEmail);
        });
    });
    
    // Reject button listeners
    document.querySelectorAll('.btn-reject').forEach(button => {
        button.addEventListener('click', async function() {
            const applicationId = this.getAttribute('data-id');
            await rejectApplication(applicationId);
        });
    });
    
    // View profile listeners
    document.querySelectorAll('.btn-view').forEach(button => {
        button.addEventListener('click', async function(e) {
            e.preventDefault();
            const applicationId = this.getAttribute('data-id');
            // You could implement a modal to show more application details here
            alert('View participant profile feature coming soon!');
        });
    });
}

// Approve Application
async function approveApplication(applicationId, userEmail) {
    try {
        await db.collection("applications").doc(applicationId).update({ 
            status: "approved",
            approvedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Optionally send notification to the user
        // await sendApprovalNotification(userEmail);
        
        alert("Application approved successfully!");
        
        // Reload the applications to refresh the table
        loadPendingApplications();
    } catch (error) {
        console.error("Error approving application:", error);
        alert("Failed to approve application. Please try again.");
    }
}
async function rejectApplication(applicationId) {
    try {
        await db.collection("applications").doc(applicationId).update({ 
            status: "rejected",
            rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        alert("Application rejected.");
        
        // Reload the applications to refresh the table
        loadPendingApplications();
    } catch (error) {
        console.error("Error rejecting application:", error);
        alert("Failed to reject application. Please try again.");
    }
}
async function loadApplications() {
    const applicationsRef = db.collection("applications").where("status", "==", "pending");
    const snapshot = await applicationsRef.get();
    const applicationsTable = document.getElementById("applications-table-body");

    applicationsTable.innerHTML = "";

    snapshot.forEach(doc => {
        const data = doc.data();
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${data.userName}</td>
            <td>${data.userEmail}</td>
            <td>${data.hackathonTitle}</td>
            <td>
                <button class="btn-approve" onclick="approveApplication('${doc.id}', '${data.userEmail}')">Approve</button>
                <button class="btn-reject" onclick="rejectApplication('${doc.id}')">Reject</button>
            </td>
        `;
        applicationsTable.appendChild(row);
    });
}

// Approve Application
async function approveApplication(applicationId, userEmail) {
    await db.collection("applications").doc(applicationId).update({ status: "approved" });

    sendApprovalEmail(userEmail); // Send approval email
    alert("Application approved!");
    loadApplications(); // Refresh applications list
}

// Reject Application
async function rejectApplication(applicationId) {
    await db.collection("applications").doc(applicationId).update({ status: "rejected" });
    alert("Application rejected.");
    loadApplications();
}

// Send Email (Using Firebase Functions or External Email API)
async function sendApprovalEmail(email) {
    const response = await fetch("https://your-email-api.com/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            to: email,
            subject: "Hackathon Application Approved!",
            message: "Congratulations! Your application has been approved. Check your dashboard for updates."
        })
    });
    console.log("Email sent:", await response.json());
}

// Load applications on page load
document.addEventListener("DOMContentLoaded", loadApplications);

// Make specific dashboard action links and buttons functional
function initializeDashboardActions() {
    // Make view all links functional
    const viewAllLinks = document.querySelectorAll('.view-all');
    viewAllLinks.forEach(link => {
        const linkText = link.textContent.trim();
        
        if (linkText === "View All Submissions") {
            link.href = "submissions.html";
        } else if (linkText === "View All Feedback") {
            link.href = "feedback.html";
        } else if (linkText === "View Full Report") {
            link.href = "reports.html";
        }
    });
    
    // Add functionality to preview buttons in judge dashboard
    const previewButtons = document.querySelectorAll('.btn-preview');
    previewButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Get project information from parent element
            const projectItem = this.closest('.project-item');
            if (projectItem) {
                const projectName = projectItem.querySelector('h4').textContent;
                // Create URL with project name as parameter
                const url = `submission-preview.html?project=${encodeURIComponent(projectName)}`;
                
                // If preview panel exists, we're updating it instead of navigating
                const previewPanel = document.getElementById('preview-panel');
                if (previewPanel) {
                    previewPanel.classList.add('active');
                } else {
                    window.location.href = url;
                }
            }
        });
    });
    
    // Add functionality to criteria details link
    const criteriaDetailsLink = document.querySelector('.criteria-details');
    if (criteriaDetailsLink) {
        criteriaDetailsLink.href = "criteria-details.html";
    }
    
    // Make resource item links functional in participant dashboard
    const resourceLinks = document.querySelectorAll('.resource-item');
    resourceLinks.forEach(link => {
        const resourceName = link.querySelector('span').textContent.trim();
        
        switch (resourceName) {
            case "Competition Guidelines":
                link.href = "guidelines.html";
                break;
            case "Tutorial Videos":
                link.href = "videos.html";
                break;
            case "Discussion Forum":
                link.href = "forum.html";
                break;
            case "FAQ":
                link.href = "faq.html";
                break;
        }
    });
    
    // Add functionality to buttons in organizer dashboard
    setupOrganizerDashboardButtons();
    
    // Add functionality to buttons in judge dashboard
    setupJudgeDashboardButtons();
    
    // Add functionality to buttons in participant dashboard
    setupParticipantDashboardButtons();
}

// Set up specific buttons for the organizer dashboard
function setupOrganizerDashboardButtons() {
    // Review registrations button
    const reviewRegistrationsBtn = document.getElementById('review-registrations');
    if (reviewRegistrationsBtn) {
        reviewRegistrationsBtn.addEventListener('click', function() {
            const registrationPanel = document.getElementById('registration-panel');
            if (registrationPanel) {
                registrationPanel.scrollIntoView({ behavior: 'smooth' });
            } else {
                window.location.href = "registration-requests.html";
            }
        });
    }
    
    // Timeline edit button
    const editTimelineBtn = document.getElementById('edit-timeline');
    if (editTimelineBtn) {
        editTimelineBtn.addEventListener('click', function() {
            window.location.href = "edit-timeline.html";
        });
    }
    
    // Approval and rejection buttons
    const approveButtons = document.querySelectorAll('.btn-approve');
    const rejectButtons = document.querySelectorAll('.btn-reject');
    
    approveButtons.forEach(button => {
        button.addEventListener('click', function() {
            const row = this.closest('tr');
            alert(`Approved registration for ${row.querySelector('td').textContent}`);
            row.style.backgroundColor = "#eaffea";
            setTimeout(() => {
                row.remove();
                updatePendingCount();
            }, 1000);
        });
    });
    
    rejectButtons.forEach(button => {
        button.addEventListener('click', function() {
            const row = this.closest('tr');
            alert(`Rejected registration for ${row.querySelector('td').textContent}`);
            row.style.backgroundColor = "#ffeaea";
            setTimeout(() => {
                row.remove();
                updatePendingCount();
            }, 1000);
        });
    });
    
    // Update pending count when approving/rejecting
    function updatePendingCount() {
        const statCircle = document.querySelector('.stat-circle.warning span');
        if (statCircle) {
            let count = parseInt(statCircle.textContent);
            count = Math.max(0, count - 1);
            statCircle.textContent = count.toString();
        }
    }
    
    // Quick action buttons
    const sendAnnouncementBtn = document.getElementById('send-announcement');
    if (sendAnnouncementBtn) {
        sendAnnouncementBtn.addEventListener('click', function() {
            const modal = document.getElementById('announcement-modal');
            if (modal) {
                modal.style.display = "block";
            } else {
                window.location.href = "send-announcement.html";
            }
        });
    }
    
    const exportDataBtn = document.getElementById('export-data');
    if (exportDataBtn) {
        exportDataBtn.addEventListener('click', function() {
            alert("Exporting data... Your file will be ready for download shortly.");
        });
    }
    
    const generateReportBtn = document.getElementById('generate-report');
    if (generateReportBtn) {
        generateReportBtn.addEventListener('click', function() {
            window.location.href = "generate-report.html";
        });
    }
    
    const configureSettingsBtn = document.getElementById('configure-settings');
    if (configureSettingsBtn) {
        configureSettingsBtn.addEventListener('click', function() {
            window.location.href = "settings.html";
        });
    }
    
    // Modal close buttons
    const closeModalBtns = document.querySelectorAll('.close-modal');
    closeModalBtns.forEach(button => {
        button.addEventListener('click', function() {
            const modal = this.closest('.modal');
            if (modal) {
                modal.style.display = "none";
            }
        });
    });
    
    // Cancel announcement button
    const cancelAnnouncementBtn = document.getElementById('cancel-announcement');
    if (cancelAnnouncementBtn) {
        cancelAnnouncementBtn.addEventListener('click', function() {
            const modal = document.getElementById('announcement-modal');
            if (modal) {
                modal.style.display = "none";
            }
        });
    }
    
    // Announcement form submission
    const announcementForm = document.getElementById('announcement-form');
    if (announcementForm) {
        announcementForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const title = document.getElementById('announcement-title').value;
            const recipients = document.getElementById('announcement-recipients').value;
            alert(`Announcement "${title}" sent to ${recipients}`);
            
            // Hide modal
            const modal = document.getElementById('announcement-modal');
            if (modal) {
                modal.style.display = "none";
            }
            
            // Reset form
            this.reset();
        });
    }
    
    // Pagination
    const paginationLinks = document.querySelectorAll('.pagination .page-link');
    paginationLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all links
            paginationLinks.forEach(l => l.classList.remove('active'));
            
            // Add active class to clicked link
            this.classList.add('active');
            
            // In a real application, this would load the appropriate page data
            alert(`Navigating to page ${this.textContent}`);
        });
    });
}

// Set up specific buttons for the judge dashboard
function setupJudgeDashboardButtons() {
    // Full submission view button
    const viewFullBtn = document.getElementById('view-full');
    if (viewFullBtn) {
        viewFullBtn.addEventListener('click', function() {
            const projectName = document.querySelector('.preview-header h4')?.textContent;
            if (projectName) {
                window.location.href = `submission-details.html?project=${encodeURIComponent(projectName)}`;
            } else {
                window.location.href = "submission-details.html";
            }
        });
    }
    
    // Save notes button
    const saveNotesBtn = document.getElementById('save-notes');
    if (saveNotesBtn) {
        saveNotesBtn.addEventListener('click', function() {
            alert("Your notes have been saved successfully");
        });
    }
    
    // Calendar button
    const calendarBtn = document.getElementById('calendar-button');
    if (calendarBtn) {
        calendarBtn.addEventListener('click', function() {
            alert("Calendar events have been added to your calendar");
        });
    }
    
    // Close preview panel
    const closePanel = document.querySelector('.close-panel');
    if (closePanel) {
        closePanel.addEventListener('click', function() {
            const previewPanel = document.getElementById('preview-panel');
            if (previewPanel) {
                previewPanel.classList.remove('active');
            }
        });
    }
    
    // Detailed criteria view
    const criteriaDetailsLink = document.querySelector('.criteria-details');
    if (criteriaDetailsLink) {
        criteriaDetailsLink.href = "criteria-details.html";
    }
}

// Set up specific buttons for the participant dashboard
function setupParticipantDashboardButtons() {
    // Submit button
    const submitBtn = document.getElementById('submit-button');
    if (submitBtn) {
        submitBtn.addEventListener('click', function() {
            window.location.href = "submit-project.html";
        });
    }
    
    // Calendar button
    const calendarBtn = document.getElementById('calendar-button');
    if (calendarBtn) {
        calendarBtn.addEventListener('click', function() {
            alert("Events added to your calendar");
        });
    }
    
    // Notification panel toggling
    const notificationsIcon = document.querySelector('.notifications');
    if (notificationsIcon) {
        notificationsIcon.addEventListener('click', function() {
            const notificationsPanel = document.getElementById('notifications-panel');
            if (notificationsPanel) {
                notificationsPanel.classList.toggle('active');
                
                // Mark notifications as read when opened
                const unreadNotifications = notificationsPanel.querySelectorAll('.notification.unread');
                unreadNotifications.forEach(notification => {
                    notification.classList.remove('unread');
                });
                
                // Update badge count
                const badge = document.querySelector('.notifications .badge');
                if (badge) {
                    badge.textContent = "0";
                    badge.style.display = "none";
                }
            }
        });
    }
}
</script>
</body>
</html>